(function(e){function r(r){for(var n,a,i=r[0],d=r[1],l=r[2],u=0,f=[];u<i.length;u++)a=i[u],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&f.push(o[a][0]),o[a]=0;for(n in d)Object.prototype.hasOwnProperty.call(d,n)&&(e[n]=d[n]);s&&s(r);while(f.length)f.shift()();return c.push.apply(c,l||[]),t()}function t(){for(var e,r=0;r<c.length;r++){for(var t=c[r],n=!0,i=1;i<t.length;i++){var d=t[i];0!==o[d]&&(n=!1)}n&&(c.splice(r--,1),e=a(a.s=t[0]))}return e}var n={},o={app:0},c=[];function a(r){if(n[r])return n[r].exports;var t=n[r]={i:r,l:!1,exports:{}};return e[r].call(t.exports,t,t.exports,a),t.l=!0,t.exports}a.m=e,a.c=n,a.d=function(e,r,t){a.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,r){if(1&r&&(e=a(e)),8&r)return e;if(4&r&&"object"===typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(a.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var n in e)a.d(t,n,function(r){return e[r]}.bind(null,n));return t},a.n=function(e){var r=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(r,"a",r),r},a.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},a.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],d=i.push.bind(i);i.push=r,i=i.slice();for(var l=0;l<i.length;l++)r(i[l]);var s=d;c.push([0,"chunk-vendors"]),t()})({0:function(e,r,t){e.exports=t("56d7")},"56d7":function(e,r,t){"use strict";t.r(r);t("e260"),t("e6cf"),t("cca6"),t("a79d");var n=t("7a23"),o={class:"VideoChoose"},c={controls:"",ref:"videoPlayer",width:"320",height:"240"},a=["src"],i={class:"BaseRecorder"},d={class:"BaseRecorder-record"},l={class:"BaseRecorder-play"},s={class:"BaseRecorder-download"},u={class:"BaseRecorder-destroy"},f={class:"BaseRecorder-wave"},p={ref:"record"},h={ref:"play"};function b(e,r,t,b,v,m){return Object(n["d"])(),Object(n["b"])("div",o,[Object(n["c"])("video",c,[Object(n["c"])("source",{src:v.videoUrl,type:"video/mp4"},null,8,a)],512),Object(n["c"])("input",{type:"file",onChange:r[0]||(r[0]=function(e){return m.filechange(e)}),accept:"video/*"},null,32),Object(n["c"])("div",i,[Object(n["c"])("div",d,[Object(n["c"])("button",{onClick:r[1]||(r[1]=function(e){return m.removeAudio()})},"消除音频"),Object(n["c"])("button",{onClick:r[2]||(r[2]=function(e){return m.startRecorder()})},"开始录音"),Object(n["c"])("button",{onClick:r[3]||(r[3]=function(e){return m.resumeRecorder()})},"继续录音"),Object(n["c"])("button",{onClick:r[4]||(r[4]=function(e){return m.pauseRecorder()})},"暂停录音"),Object(n["c"])("button",{onClick:r[5]||(r[5]=function(e){return m.stopRecorder()})},"结束录音"),Object(n["c"])("button",{onClick:r[6]||(r[6]=function(e){return m.transcode()})}," 配音")]),Object(n["c"])("div",l,[Object(n["c"])("button",{onClick:r[7]||(r[7]=function(e){return m.playRecorder()})},"录音播放"),Object(n["c"])("button",{onClick:r[8]||(r[8]=function(e){return m.pausePlayRecorder()})},"暂停录音播放"),Object(n["c"])("button",{onClick:r[9]||(r[9]=function(e){return m.resumePlayRecorder()})},"恢复录音播放"),Object(n["c"])("button",{onClick:r[10]||(r[10]=function(e){return m.stopPlayRecorder()})},"停止录音播放")]),Object(n["c"])("div",s,[Object(n["c"])("button",{onClick:r[11]||(r[11]=function(e){return m.downPCM()})},"下载PCM"),Object(n["c"])("button",{onClick:r[12]||(r[12]=function(e){return m.downWAV()})},"下载WAV")]),Object(n["c"])("div",u,[Object(n["c"])("button",{type:"error",onClick:r[13]||(r[13]=function(e){return m.destroyRecorder()})},"销毁录音")]),Object(n["c"])("div",f,[Object(n["c"])("canvas",p,null,512),Object(n["c"])("canvas",h,null,512)])])])}var v=t("1da1"),m=(t("96cf"),t("d3b7"),t("3ca3"),t("ddb0"),t("2b3d"),t("9861"),t("99af"),t("b0c0"),t("da43")),y=t.n(m),g=t("9110"),w={name:"home",data:function(){return{ffmpeg:null,recorder:null,drawRecordId:null,drawPlayId:null,videoUrl:"taylorswift.mp4",recoderUrl:""}},mounted:function(){this.init()},methods:{transcode:function(){var e=this;return Object(v["a"])(regeneratorRuntime.mark((function r(){var t,n,o,c;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t="taylorswift.mp4",n="my.mp3",r.t0=e.ffmpeg,r.next=5,Object(g["fetchFile"])(t);case 5:return r.t1=r.sent,r.t0.FS.call(r.t0,"writeFile","test.mp4",r.t1),r.t2=e.ffmpeg,r.next=10,Object(g["fetchFile"])(n);case 10:return r.t3=r.sent,r.t2.FS.call(r.t2,"writeFile","my.mp3",r.t3),r.next=14,e.ffmpeg.run("-i","test.mp4","-vcodec","copy","-an","no_audio_video.mp4");case 14:return r.next=16,e.ffmpeg.run("-y","-i","no_audio_video.mp4","-i","my.mp3","-vcodec","copy","-acodec","copy","get.mp4");case 16:o=e.ffmpeg.FS("readFile","get.mp4"),c=URL.createObjectURL(new Blob([o.buffer],{type:"video/mp4"})),e.videoUrl=c,console.log(e.videoUrl),e.$refs.videoPlayer.load(),console.log(c);case 22:case"end":return r.stop()}}),r)})))()},removeAudio:function(){var e=this;return Object(v["a"])(regeneratorRuntime.mark((function r(){var t,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.t0=e.ffmpeg,r.next=3,Object(g["fetchFile"])(e.videoUrl);case 3:return r.t1=r.sent,r.t0.FS.call(r.t0,"writeFile","test.mp4",r.t1),r.next=7,e.ffmpeg.run("-i","test.mp4","-vcodec","copy","-an","no_audio_video.mp4");case 7:t=e.ffmpeg.FS("readFile","no_audio_video.mp4"),n=URL.createObjectURL(new Blob([t.buffer],{type:"video/mp4"})),e.videoUrl=n,console.log(e.videoUrl),e.$refs.videoPlayer.load(),console.log(n);case 13:case"end":return r.stop()}}),r)})))()},filechange:function(e){console.log(e);var r=e.target.files;console.log(r[0]);var t=new Blob([r[0]],{type:"video/mp4"});console.log(t),this.videoUrl=URL.createObjectURL(t),this.$refs.videoPlayer.load()},init:function(){var e=this;return Object(v["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e.recorder=new y.a({sampleBits:16,sampleRate:48e3,numChannels:1,compiling:!1}),e.ffmpeg=Object(g["createFFmpeg"])({log:!0}),r.next=3,e.ffmpeg.load();case 3:case"end":return r.stop()}}),r)})))()},startRecorder:function(){var e=this;this.recorder.start().then((function(){e.drawRecord()}),(function(e){console.log("".concat(e.name," : ").concat(e.message))}))},resumeRecorder:function(){this.recorder.resume()},pauseRecorder:function(){this.recorder.pause(),this.drawRecordId&&cancelAnimationFrame(this.drawRecordId),this.drawRecordId=null},stopRecorder:function(){this.recorder.stop(),this.drawRecordId&&cancelAnimationFrame(this.drawRecordId),this.drawRecordId=null,this.getPCMData()},playRecorder:function(){this.recorder.play(),this.drawPlay()},pausePlayRecorder:function(){this.recorder.pausePlay()},resumePlayRecorder:function(){this.recorder.resumePlay(),this.drawPlay()},stopPlayRecorder:function(){this.recorder.stopPlay()},destroyRecorder:function(){this.recorder.destroy().then((function(){this.drawRecordId&&cancelAnimationFrame(this.drawRecordId),this.drawRecordId=null,this.drawPlayId&&cancelAnimationFrame(this.drawPlayId),this.drawPlayId=null,this.recorder=null}))},getRecordata:function(){this.recorder.getRecordAnalyseData()},getPCMData:function(){var e=this.recorder.getPCMBlob();console.log(e),this.recoderUrl=URL.createObjectURL(e),console.log(this.recoderUrl)},downPCM:function(){this.recorder.downloadPCM("新文件")},downWAV:function(){this.recorder.downloadWAV("新文件")},drawRecord:function(){this.drawRecordId=requestAnimationFrame(this.drawRecord),this.drawWave({canvas:this.$refs.record,dataArray:this.recorder.getRecordAnalyseData(),bgcolor:"rgb(255, 128, 200)",lineWidth:1,lineColor:"rgb(0, 128, 255)"})},drawPlay:function(){this.drawPlayId=requestAnimationFrame(this.drawPlay),this.drawWave({canvas:this.$refs.play,dataArray:this.recorder.getPlayAnalyseData()})},drawWave:function(e){var r=e.canvas,t=e.dataArray,n=e.bgcolor,o=void 0===n?"rgb(200, 200, 200)":n,c=e.lineWidth,a=void 0===c?2:c,i=e.lineColor,d=void 0===i?"rgb(0, 0, 0)":i;if(r){var l=r.getContext("2d"),s=t.length,u=r.width/s,f=0;l.fillStyle=o,l.fillRect(0,0,r.width,r.height),l.lineWidth=a,l.strokeStyle=d,l.beginPath();for(var p=0;p<s;p++){var h=t[p]/128,b=h*r.height/2;0===p?l.moveTo(f,b):l.lineTo(f,b),f+=u}l.lineTo(r.width,r.height/2),l.stroke()}}}},R=t("6b0d"),O=t.n(R);const j=O()(w,[["render",b]]);var P=j;Object(n["a"])(P).mount("#app")}});
//# sourceMappingURL=app.a025ca17.js.map