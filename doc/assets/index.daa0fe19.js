import{s as a,j as p,o as h,c as m,a as o,b as g,F as y,d as v}from"./vendor.604c91cd.js";const w=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))l(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&l(i)}).observe(document,{childList:!0,subtree:!0});function d(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function l(s){if(s.ep)return;s.ep=!0;const r=d(s);fetch(s.href,r)}};w();var R="/assets/logo.03d6d6da.png",b=(t,e)=>{const d=t.__vccOpts||t;for(const[l,s]of e)d[l]=s;return d};const P={name:"home",data(){return{ffmpeg:null,recorder:null,drawRecordId:null,drawPlayId:null,videoUrl:"taylorswift.mp4",recoderUrl:""}},mounted(){this.init()},methods:{async transcode(){this.ffmpeg.FS("writeFile","test.mp4",await a.fetchFile(this.videoUrl)),this.ffmpeg.FS("writeFile","my.wav",await a.fetchFile(this.recoderUrl)),await this.ffmpeg.run("-i","my.wav","my.mp3"),await this.ffmpeg.run("-i","test.mp4","-vcodec","copy","-an","no_audio_video.mp4"),await this.ffmpeg.run("-y","-i","no_audio_video.mp4","-i","my.mp3","-vcodec","copy","-acodec","copy","get.mp4");const t=this.ffmpeg.FS("readFile","get.mp4"),e=URL.createObjectURL(new Blob([t.buffer],{type:"video/mp4"}));this.videoUrl=e,console.log(this.videoUrl),this.$refs.videoPlayer.load(),console.log(e)},async removeAudio(){this.ffmpeg.FS("writeFile","test.mp4",await a.fetchFile(this.videoUrl)),await this.ffmpeg.run("-i","test.mp4","-vcodec","copy","-an","no_audio_video.mp4");const t=this.ffmpeg.FS("readFile","no_audio_video.mp4"),e=URL.createObjectURL(new Blob([t.buffer],{type:"video/mp4"}));this.videoUrl=e,console.log(this.videoUrl),this.$refs.videoPlayer.load(),console.log(e)},filechange(t){console.log(t);const e=t.target.files;console.log(e[0]);const d=new Blob([e[0]],{type:"video/mp4"});console.log(d),this.videoUrl=URL.createObjectURL(d),this.$refs.videoPlayer.load()},async init(){this.recorder=new p({sampleBits:16,sampleRate:48e3,numChannels:1,compiling:!1}),this.ffmpeg=a.createFFmpeg({log:!0}),await this.ffmpeg.load()},startRecorder(){this.recorder.start().then(()=>{this.drawRecord()},t=>{console.log(`${t.name} : ${t.message}`)})},resumeRecorder(){this.recorder.resume()},pauseRecorder(){this.recorder.pause(),this.drawRecordId&&cancelAnimationFrame(this.drawRecordId),this.drawRecordId=null},stopRecorder(){this.recorder.stop(),this.drawRecordId&&cancelAnimationFrame(this.drawRecordId),this.drawRecordId=null,this.getWAVData()},playRecorder(){this.recorder.play(),this.drawPlay()},pausePlayRecorder(){this.recorder.pausePlay()},resumePlayRecorder(){this.recorder.resumePlay(),this.drawPlay()},stopPlayRecorder(){this.recorder.stopPlay()},destroyRecorder(){this.recorder.destroy().then(function(){this.drawRecordId&&cancelAnimationFrame(this.drawRecordId),this.drawRecordId=null,this.drawPlayId&&cancelAnimationFrame(this.drawPlayId),this.drawPlayId=null,this.recorder=null})},getRecordata(){var t=this.recorder.getRecordAnalyseData();this.recoderUrl=URL.createObjectURL(new Blob([t],{type:"video/mp3"})),console.log(t)},getPCMData(){var t=this.recorder.getPCMBlob();console.log(t),this.recoderUrl=URL.createObjectURL(t),console.log(this.recoderUrl)},getWAVData(){var t=this.recorder.getWAVBlob();console.log(t),this.recoderUrl=URL.createObjectURL(t),console.log(this.recoderUrl)},downPCM(){this.recorder.downloadPCM("\u65B0\u6587\u4EF6")},downWAV(){this.recorder.downloadWAV("\u65B0\u6587\u4EF6")},drawRecord(){this.drawRecordId=requestAnimationFrame(this.drawRecord),this.drawWave({canvas:this.$refs.record,dataArray:this.recorder.getRecordAnalyseData(),bgcolor:"rgb(255, 128, 200)",lineWidth:1,lineColor:"rgb(0, 128, 255)"})},drawPlay(){this.drawPlayId=requestAnimationFrame(this.drawPlay),this.drawWave({canvas:this.$refs.play,dataArray:this.recorder.getPlayAnalyseData()})},drawWave({canvas:t,dataArray:e,bgcolor:d="rgb(200, 200, 200)",lineWidth:l=2,lineColor:s="rgb(0, 0, 0)"}){if(!t)return;const r=t.getContext("2d"),i=e.length,f=t.width/i;let c=0;r.fillStyle=d,r.fillRect(0,0,t.width,t.height),r.lineWidth=l,r.strokeStyle=s,r.beginPath();for(let n=0;n<i;n++){const u=e[n]/128*t.height/2;n===0?r.moveTo(c,u):r.lineTo(c,u),c+=f}r.lineTo(t.width,t.height/2),r.stroke()}}},_={class:"VideoChoose"},U={controls:"",ref:"videoPlayer",width:"320",height:"240"},F=["src"],C={class:"BaseRecorder"},A={class:"BaseRecorder-record"},B={class:"BaseRecorder-play"},k={class:"BaseRecorder-download"},L={class:"BaseRecorder-destroy"},I={class:"BaseRecorder-wave"},W={ref:"record"},V={ref:"play"};function O(t,e,d,l,s,r){return h(),m("div",_,[o("video",U,[o("source",{src:s.videoUrl,type:"video/mp4"},null,8,F)],512),o("input",{type:"file",onChange:e[0]||(e[0]=i=>r.filechange(i)),accept:"video/*"},null,32),o("div",C,[o("div",A,[o("button",{onClick:e[1]||(e[1]=i=>r.removeAudio())},"\u6D88\u9664\u97F3\u9891"),o("button",{onClick:e[2]||(e[2]=i=>r.startRecorder())},"\u5F00\u59CB\u5F55\u97F3"),o("button",{onClick:e[3]||(e[3]=i=>r.resumeRecorder())},"\u7EE7\u7EED\u5F55\u97F3"),o("button",{onClick:e[4]||(e[4]=i=>r.pauseRecorder())},"\u6682\u505C\u5F55\u97F3"),o("button",{onClick:e[5]||(e[5]=i=>r.stopRecorder())},"\u7ED3\u675F\u5F55\u97F3"),o("button",{onClick:e[6]||(e[6]=i=>r.transcode())}," \u914D\u97F3")]),o("div",B,[o("button",{onClick:e[7]||(e[7]=i=>r.playRecorder())},"\u5F55\u97F3\u64AD\u653E"),o("button",{onClick:e[8]||(e[8]=i=>r.pausePlayRecorder())},"\u6682\u505C\u5F55\u97F3\u64AD\u653E"),o("button",{onClick:e[9]||(e[9]=i=>r.resumePlayRecorder())},"\u6062\u590D\u5F55\u97F3\u64AD\u653E"),o("button",{onClick:e[10]||(e[10]=i=>r.stopPlayRecorder())},"\u505C\u6B62\u5F55\u97F3\u64AD\u653E")]),o("div",k,[o("button",{onClick:e[11]||(e[11]=i=>r.downPCM())},"\u4E0B\u8F7DPCM"),o("button",{onClick:e[12]||(e[12]=i=>r.downWAV())},"\u4E0B\u8F7DWAV")]),o("div",L,[o("button",{type:"error",onClick:e[13]||(e[13]=i=>r.destroyRecorder())},"\u9500\u6BC1\u5F55\u97F3")]),o("div",I,[o("canvas",W,null,512),o("canvas",V,null,512)])])])}var $=b(P,[["render",O]]);const j=o("img",{alt:"Vue logo",src:R},null,-1),S={setup(t){return(e,d)=>(h(),m(y,null,[j,g($,{msg:"Hello Vue 3 + Vite"})],64))}};v(S).mount("#app");
