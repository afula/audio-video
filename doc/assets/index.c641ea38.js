import{s as _,j as U,r as h,o as v,c as y,a as l,b as d,w as n,d as b,e as f,p as $,u as F,f as L,g as C,h as B,i as A,k}from"./vendor.ca7048dc.js";const I=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const t of r)if(t.type==="childList")for(const i of t.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function s(r){const t={};return r.integrity&&(t.integrity=r.integrity),r.referrerpolicy&&(t.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?t.credentials="include":r.crossorigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function a(r){if(r.ep)return;r.ep=!0;const t=s(r);fetch(r.href,t)}};I();var R=(e,o)=>{const s=e.__vccOpts||e;for(const[a,r]of o)s[a]=r;return s};const x={name:"home",data(){return{ffmpeg:null,recorder:null,drawRecordId:null,drawPlayId:null,videoUrl:"",recoderUrl:"",playing:!1,isShowCanvas:!0,playingTitle:"\u89C6\u9891\u64AD\u653E"}},mounted(){this.videoUrl=this.$route.params.videoUrl,console.log(this.$route.params),console.log(this.$route.params.videoUrl),this.init()},methods:{async transcode(){this.ffmpeg.FS("writeFile","test.mp4",await _.fetchFile(this.videoUrl)),this.ffmpeg.FS("writeFile","my.wav",await _.fetchFile(this.recoderUrl)),await this.ffmpeg.run("-i","my.wav","my.mp3"),await this.ffmpeg.run("-i","test.mp4","-vcodec","copy","-an","no_audio_video.mp4"),await this.ffmpeg.run("-y","-i","no_audio_video.mp4","-i","my.mp3","-vcodec","copy","-acodec","copy","get.mp4");const e=this.ffmpeg.FS("readFile","get.mp4"),o=URL.createObjectURL(new Blob([e.buffer],{type:"video/mp4"}));this.videoUrl=o,console.log(this.videoUrl),this.$refs.videoPlayer.load(),console.log(o)},async removeAudio(){this.ffmpeg.FS("writeFile","test.mp4",await _.fetchFile(this.videoUrl)),await this.ffmpeg.run("-i","test.mp4","-vcodec","copy","-an","no_audio_video.mp4");const e=this.ffmpeg.FS("readFile","no_audio_video.mp4"),o=URL.createObjectURL(new Blob([e.buffer],{type:"video/mp4"}));this.videoUrl=o,console.log(this.videoUrl),this.$refs.videoPlayer.load(),console.log(o)},filechange(e){console.log(e);const o=e.target.files;console.log(o[0]);const s=new Blob([o[0]],{type:"video/mp4"});console.log(s),this.videoUrl=URL.createObjectURL(s),this.$refs.videoPlayer.load()},async init(){this.recorder=new U({sampleBits:16,sampleRate:48e3,numChannels:1,compiling:!1}),this.ffmpeg=_.createFFmpeg({log:!0}),await this.ffmpeg.load()},videoPlayOrStop(){this.playing?(this.$refs.videoPlayer.pause(),this.playingTitle="\u89C6\u9891\u64AD\u653E",this.playing=!1):(this.$refs.videoPlayer.play(),this.playingTitle="\u6682\u505C\u64AD\u653E",this.playing=!0)},startRecorder(){this.$refs.videoPlayer.load(),this.$refs.videoPlayer.muted=!0,this.recorder.start().then(()=>{this.$refs.videoPlayer.play(),this.drawRecord(),this.isShowCanvas=!0},e=>{console.log(`${e.name} : ${e.message}`)})},resumeRecorder(){this.$refs.videoPlayer.play(),this.recorder.resume(),this.drawRecord()},pauseRecorder(){this.recorder.pause(),this.$refs.videoPlayer.pause(),this.drawRecordId&&cancelAnimationFrame(this.drawRecordId),this.drawRecordId=null},stopRecorder(){this.recorder.stop(),this.$refs.videoPlayer.pause(),this.drawRecordId&&cancelAnimationFrame(this.drawRecordId),this.drawRecordId=null,this.getWAVData(),this.isShowCanvas=!1},playRecorder(){this.recorder.play(),this.drawPlay()},pausePlayRecorder(){this.recorder.pausePlay()},resumePlayRecorder(){this.recorder.resumePlay(),this.drawPlay()},stopPlayRecorder(){this.recorder.stopPlay()},destroyRecorder(){this.recorder.destroy().then(function(){this.drawRecordId&&cancelAnimationFrame(this.drawRecordId),this.drawRecordId=null,this.drawPlayId&&cancelAnimationFrame(this.drawPlayId),this.drawPlayId=null,this.recorder=null})},getRecordata(){var e=this.recorder.getRecordAnalyseData();this.recoderUrl=URL.createObjectURL(new Blob([e],{type:"video/mp3"})),console.log(e)},getPCMData(){var e=this.recorder.getPCMBlob();console.log(e),this.recoderUrl=URL.createObjectURL(e),console.log(this.recoderUrl)},getWAVData(){var e=this.recorder.getWAVBlob();console.log(e),this.recoderUrl=URL.createObjectURL(e),console.log(this.recoderUrl)},downPCM(){this.recorder.downloadPCM("\u65B0\u6587\u4EF6")},downWAV(){this.recorder.downloadWAV("\u65B0\u6587\u4EF6")},drawRecord(){this.drawRecordId=requestAnimationFrame(this.drawRecord),this.drawWave({canvas:this.$refs.record,dataArray:this.recorder.getRecordAnalyseData(),bgcolor:"rgb(255, 255, 255)",lineWidth:1,lineColor:"rgb(0, 128, 255)"})},drawPlay(){this.drawPlayId=requestAnimationFrame(this.drawPlay),this.drawWave({canvas:this.$refs.play,dataArray:this.recorder.getPlayAnalyseData()})},drawWave({canvas:e,dataArray:o,bgcolor:s="rgb(255, 255, 255)",lineWidth:a=2,lineColor:r="rgb(0, 0, 0)"}){if(!e)return;const t=e.getContext("2d"),i=o.length,c=e.width/i;let p=0;t.fillStyle=s,t.fillRect(0,0,e.width,e.height),console.log(e),t.lineWidth=a,t.strokeStyle=r,t.beginPath();for(let u=0;u<i;u++){const m=o[u]/128*e.height/2;u===0?t.moveTo(p,m):t.lineTo(p,m),p+=c}t.lineTo(e.width,e.height/2),t.stroke()}}},O={class:"VideoChoose"},S={controls:"",ref:"videoPlayer",class:"video-dispaly"},W=["src"],j={class:"BaseRecorder"},V={class:"BaseRecorder-record"},M=f("\u5F00\u59CB\u914D\u97F3"),N=f("\u6682\u505C\u914D\u97F3"),T=f("\u7EE7\u7EED\u914D\u97F3"),D=f("\u7ED3\u675F\u914D\u97F3"),E={class:"BaseRecorder-play"},H=f("\u97F3\u89C6\u9891\u5408\u6210"),q=l("div",{class:"BaseRecorder-download"},null,-1),K=l("div",{class:"BaseRecorder-destroy"},null,-1),z={class:"BaseRecorder-wave"},G={key:0,ref:"record"};function J(e,o,s,a,r,t){const i=h("el-button");return v(),y("div",O,[l("video",S,[l("source",{src:r.videoUrl,type:"video/mp4"},null,8,W)],512),l("div",j,[l("div",V,[d(i,{onClick:o[0]||(o[0]=c=>t.startRecorder()),class:"operate-recorder"},{default:n(()=>[M]),_:1}),d(i,{onClick:o[1]||(o[1]=c=>t.pauseRecorder()),class:"operate-recorder"},{default:n(()=>[N]),_:1}),d(i,{onClick:o[2]||(o[2]=c=>t.resumeRecorder()),class:"operate-recorder"},{default:n(()=>[T]),_:1}),d(i,{onClick:o[3]||(o[3]=c=>t.stopRecorder()),class:"operate-recorder"},{default:n(()=>[D]),_:1})]),l("div",E,[d(i,{onClick:o[4]||(o[4]=c=>t.transcode())},{default:n(()=>[H]),_:1})]),q,K,l("div",z,[r.isShowCanvas?(v(),y("canvas",G,null,512)):b("",!0)])])])}var Q=R(x,[["render",J]]);const X={components:{Plus:$,Upload:F},methods:{clickLoad(){this.$refs.refFile.dispatchEvent(new MouseEvent("click"))},fileLoad(e){console.log(e);const o=e.target.files;console.log(o[0]);const s=new Blob([o[0]],{type:"video/mp4"});console.log(s);const a=URL.createObjectURL(s);this.$router.push({name:"home",params:{videoUrl:a}})}}},Y={class:"common-layout"},Z=l("p",{class:"header-title"},"audio-video",-1),ee={class:"text item"},oe=l("div",null,"\u70B9\u51FB\u9009\u62E9\u89C6\u9891",-1);function te(e,o,s,a,r,t){const i=h("el-header"),c=h("Plus"),p=h("el-icon"),u=h("el-card"),w=h("el-main"),m=h("el-container");return v(),y("div",Y,[d(m,null,{default:n(()=>[d(i,null,{default:n(()=>[Z]),_:1}),d(w,null,{default:n(()=>[d(u,{class:"box-card",onClick:t.clickLoad},{default:n(()=>[l("div",ee,[d(p,{class:"avatar-uploader-icon"},{default:n(()=>[d(c)]),_:1}),l("input",{type:"file",id:"files",ref:"refFile",style:{display:"none"},onChange:o[0]||(o[0]=P=>t.fileLoad(P)),accept:"video/*"},null,544),oe])]),_:1},8,["onClick"])]),_:1})]),_:1})])}var re=R(X,[["render",te]]);const se={setup(e){return(o,s)=>{const a=h("router-view");return v(),L(a)}}},ie=[{path:"/",component:re},{path:"/home/:videoUrl",name:"home",component:Q}],ae=C({history:B(),routes:ie}),g=A(se);g.use(k);g.use(ae);g.mount("#app");
